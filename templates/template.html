<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>訪問看護報告書</title>
    <style>
      @page {
        size: A4;
        margin: 2mm 5mm 5mm 5mm;
      }

      @media print {
        body {
          width: 210mm;
          height: 297mm;
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }

        .container {
          border: none;
          padding: 2mm 5mm 5mm 5mm;
        }
      }

      body {
        font-family: 'MS Gothic', 'MS Mincho', sans-serif;
        line-height: 1.4;
        background: white;
      }

      .container {
        max-width: 210mm;
        margin: 0 auto;
        padding: 2mm;
        box-sizing: border-box;
      }

      .header {
        text-align: center;
        margin-bottom: 10px;
        position: relative;
      }

      .form-number {
        position: absolute;
        top: 0;
        right: 0;
      }

      h1 {
        font-size: 18pt;
        margin: 2px 0;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 5px;
        page-break-inside: avoid;
      }

      th,
      td {
        border: 1px solid #000;
        padding: 4px;
        text-align: left;
        font-size: 10.5pt;
      }

      th {
        background-color: #f5f5f5;
        font-weight: normal;
      }

      .calendar-row {
        display: flex;
        justify-content: space-between;
      }

      .calendar {
        width: 48%;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .calendar-header {
        text-align: center;
        margin-bottom: 2px;
        font-size: 10pt;
        width: 100%;
      }

      .exact-calendar {
        width: auto;
        border-collapse: collapse;
        margin: 0 auto;
      }

      .exact-calendar td {
        text-align: center;
        padding: 1px 5px;
        font-size: 10pt;
        border: none;
        height: 18px;
        position: relative;
      }

      .calendar-note {
        margin-top: 5px;
        font-size: 9pt;
        line-height: 1.3;
        text-align: center;
      }

      .empty-space {
        height: 60px;
      }

      .footer-report-text {
        text-align: left;
        margin: 25px 0 15px 0;
        font-size: 10.5pt;
      }

      .footer-signature {
        width: 100%;
        border-collapse: collapse;
      }

      .footer-signature td {
        border: none;
        padding: 3px;
        vertical-align: top;
      }

      .left-cell {
        width: 50%;
        text-align: center;
      }

      .right-cell {
        width: 50%;
        text-align: left;
      }

      .stamp-area {
        text-align: right;
      }

      .furigana {
        font-size: 9pt;
        line-height: 1;
      }

      .symbol {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 14pt;
        pointer-events: none;
      }

      .date-text {
        position: relative;
        z-index: 1;
      }

      .circle::before {
        content: '○';
      }

      .triangle::before {
        content: '△';
      }

      .cross::before {
        content: '×';
      }

      .diamond::before {
        content: '◇';
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="header">
        <h1>訪問看護報告書</h1>
      </div>

      <table>
        <tr>
          <th style="width: 20%">利用者氏名</th>
          <td style="width: 30%; height: 60px; vertical-align: top">
            <div style="display: flex; flex-direction: column; height: 100%">
              <div style="flex: 0 0 20%" class="furigana">{{furigana}}</div>
              <div style="flex: 0 0 80%; display: flex; align-items: center">{{user_name}}</div>
            </div>
          </td>
          <th style="width: 20%">生年月日</th>
          <td style="width: 30%">{{birth_date}}</td>
        </tr>
        <tr>
          <th>要介護認定の状況</th>
          <td colspan="3">要支援（１　２）　要介護（１　２　３　４　５）</td>
        </tr>
        <tr>
          <th>住所</th>
          <td colspan="3">{{address}}</td>
        </tr>
        <tr>
          <th>訪問日</th>
          <td colspan="3">
            <div class="calendar-row" id="calendarContainer">
              <script>
                function generateCalendar(year, month) {
                  const firstDay = new Date(year, month, 1);
                  const lastDay = new Date(year, month + 1, 0);

                  const today = new Date();
                  const todayYear = today.getFullYear();
                  const todayMonth = today.getMonth();
                  const todayDate = today.getDate();

                  let calendarHtml = `
                  <div class="calendar">
                    <div class="calendar-header">
                      <div>${year}年${month + 1}月</div>
                    </div>
                    <table class="exact-calendar">
                      <tbody>
                `;

                  const firstDayOfWeek = firstDay.getDay();
                  let currentDay = 1;

                  while (currentDay <= lastDay.getDate()) {
                    let weekHtml = '<tr>';

                    for (let i = 0; i < 7; i++) {
                      if (
                        (currentDay === 1 && i < firstDayOfWeek) ||
                        currentDay > lastDay.getDate()
                      ) {
                        weekHtml += '<td></td>';
                      } else {
                        let symbol = '';
                        if (year === todayYear && month === todayMonth) {
                          if (currentDay === todayDate) {
                            symbol = '<span class="symbol circle"></span>';
                          } else if (currentDay === todayDate + 1) {
                            symbol = '<span class="symbol triangle"></span>';
                          } else if (currentDay === todayDate + 2) {
                            symbol = '<span class="symbol cross"></span>';
                          }
                        }

                        weekHtml += `<td><span class="date-text">${currentDay}</span>${symbol}</td>`;
                        currentDay++;
                      }
                    }

                    weekHtml += '</tr>';
                    calendarHtml += weekHtml;
                  }

                  calendarHtml += `
                      </tbody>
                    </table>
                  </div>
                `;

                  return calendarHtml;
                }

                const today = new Date();
                const currentYear = today.getFullYear();
                const currentMonth = today.getMonth();

                const nextMonth = currentMonth === 11 ? 0 : currentMonth + 1;
                const nextYear = currentMonth === 11 ? currentYear + 1 : currentYear;

                const container = document.getElementById('calendarContainer');
                container.innerHTML =
                  generateCalendar(currentYear, currentMonth) +
                  generateCalendar(nextYear, nextMonth);
              </script>
            </div>
            <div class="calendar-note">
              訪問日を〇で囲むこと。理学療法士、作業療法士又は言語聴覚士による<br />
              訪問看護を実施した場合は◇、特別訪問看護指示書に基づく訪問看護を<br />
              実施した日は△で囲むこと。緊急時訪問を行った場合は×印とすること。<br />
              なお、右表は訪問日が２月にわたる場合使用すること。
            </div>
          </td>
        </tr>
        <tr>
          <th>病状の経過</th>
          <td colspan="3" class="empty-space"></td>
        </tr>
        <tr>
          <th>看護の内容</th>
          <td colspan="3" class="empty-space"></td>
        </tr>
        <tr>
          <th>家庭での介護の状況</th>
          <td colspan="3" class="empty-space"></td>
        </tr>
        <tr>
          <th>衛生材料等の使用量および使用状況</th>
          <td colspan="3">
            <p>衛生材料等の名称：（　　　　　　　　　　　　）</p>
            <p>使用及び交換頻度：（　　　　　　　　　　　　）</p>
            <p>使用量：（　　　　　　　　　　　　　　　　　）</p>
          </td>
        </tr>
        <tr>
          <th>衛生材料等の種類・量の変更</th>
          <td colspan="3">
            <p>衛生材料等(種類・サイズ・必要量等)の変更の必要性：　有　・　無</p>
            <p>変更内容：</p>
            <div class="empty-space"></div>
          </td>
        </tr>
        <tr>
          <th colspan="4">特記すべき事項</th>
        </tr>
        <tr>
          <td colspan="4" class="empty-space"></td>
        </tr>
      </table>

      <div class="footer-report-text">上記のとおり、指定訪問看護の実施について報告いたします。</div>

      <table class="footer-signature">
        <tr>
          <td class="left-cell">
            　　年　　月　　日<br />
            <br />
            <br />
            　　　　　　　　　殿
          </td>
          <td class="right-cell">
            事業所名<br />
            管理者氏名<span class="stamp-area">　　　　　　　　印</span>
          </td>
        </tr>
      </table>
    </div>
  </body>
</html>
