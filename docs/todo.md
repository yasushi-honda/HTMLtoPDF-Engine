# 開発計画と進捗管理

## フェーズ1: プロジェクトセットアップ 
- [x] 1.1 開発環境構築
  - [x] Node.js v18以上のインストール確認
  - [x] プロジェクトディレクトリの作成
  - [x] .gitignoreの設定
  - [x] ESLintとPrettierの設定
  - [x] TypeScript設定

- [x] 1.2 依存パッケージのセットアップ
  - [x] 本番パッケージインストール
    ```bash
    npm install express puppeteer @google-cloud/local-auth googleapis
    ```
  - [x] 開発用パッケージインストール
    ```bash
    npm install --save-dev nodemon eslint prettier @types/node typescript ts-node @typescript-eslint/parser @typescript-eslint/eslint-plugin
    ```

- [x] 1.3 プロジェクト構成の作成
  ```
  dynamic-html-to-pdf/
  ├── src/
  │   ├── server.ts          # メインサーバーファイル
  │   ├── services/          # ビジネスロジック
  │   │   ├── calendar.ts    # カレンダー生成
  │   │   ├── pdf.ts        # PDF生成
  │   │   └── drive.ts      # Google Drive操作
  │   ├── middleware/        # ミドルウェア
  │   ├── config/           # 設定ファイル
  │   ├── types/            # 型定義
  │   └── utils/            # ユーティリティ関数
  ├── templates/            # HTMLテンプレート
  │   └── template.html
  ├── tests/               # テストファイル
  └── docs/                # ドキュメント
  ```

## 次のステップ: フェーズ2へ
- [x] 2.1 カレンダー生成機能の実装開始
  - [x] 型定義の作成
  - [x] カレンダー生成ロジックの実装
  - [x] テストケースの作成

- [ ] 2.2 PDF生成機能の実装
  - [ ] Puppeteerの設定
  - [ ] PDF生成ロジックの実装
  - [ ] テストケースの作成

## 開発メモ
### 2025-02-20
- プロジェクトの初期設定完了
- TypeScript + ESLint + Prettierの開発環境構築
- ディレクトリ構造の整備
- 必要なパッケージのインストール
- カレンダー生成機能の実装完了
  - 型定義とインターフェースの作成
  - カレンダー生成ロジックの実装
  - Jest環境の構築とテストケース作成
  - テストカバレッジ90%以上達成

### 2025-02-21
- カレンダー生成機能の実装完了
  - 型定義とインターフェースの作成
  - カレンダー生成ロジックの実装
  - Jest環境の構築とテストケース作成
  - テストカバレッジ90%以上達成

### 使用パッケージのバージョン
- Node.js: v18.x
- TypeScript: 5.7.3
- Express: 最新版
- Puppeteer: 最新版
- ESLint: 9.20.1
- Prettier: 3.5.1

### 開発環境設定
- `npm run dev`: 開発サーバー起動
- `npm run build`: TypeScriptビルド
- `npm run lint`: コード品質チェック
- `npm run format`: コードフォーマット
- `npm test`: テスト実行

### コーディング規約
1. 型安全性を重視
   - 明示的な型定義
   - any型の使用を制限
   - インターフェースの活用

2. エラーハンドリング
   - try-catchによる適切な例外処理
   - エラーログの出力
   - クライアントへの適切なエラーレスポンス

3. コードスタイル
   - ESLintとPrettierに従う
   - 関数は単一責任の原則に従う
   - コメントは必要最小限に

## フェーズ2: 基本機能実装
- [x] 2.1 カレンダー生成機能
  - [x] generateCalendarHTML関数の実装
  - [x] オーバーレイ処理の実装（○、△、◇、×）
  - [x] カレンダーのテストケース作成

- [ ] 2.2 PDF生成機能
  - [ ] puppeteerセットアップ
  - [ ] HTML→PDF変換処理の実装
  - [ ] PDFオプション設定（A4、マージン等）
  - [ ] エラーハンドリング実装

- [ ] 2.3 Google Drive連携
  - [ ] Workload Identity設定
  - [ ] Drive API統合
  - [ ] アップロード機能実装
  - [ ] URL生成処理

## フェーズ3: APIエンドポイント実装
- [ ] 3.1 Express.jsサーバー構築
  - [ ] サーバー基本設定
  - [ ] ルーティング設定
  - [ ] ミドルウェア実装（エラーハンドリング、ログ）

- [ ] 3.2 /generate-pdf エンドポイント
  - [ ] リクエストバリデーション
  - [ ] レスポンス形式の統一
  - [ ] エラーレスポンス設計

## フェーズ4: セキュリティ実装
- [ ] 4.1 認証・認可
  - [ ] Workload Identity設定
  - [ ] IAMポリシー設定
  - [ ] AppSheet連携設定

- [ ] 4.2 入力検証
  - [ ] パラメーターバリデーション
  - [ ] サニタイズ処理
  - [ ] レートリミット実装

## フェーズ5: テスト実装
- [ ] 5.1 単体テスト
  - [ ] カレンダー生成テスト
  - [ ] PDF生成テスト
  - [ ] Drive APIテスト

- [ ] 5.2 結合テスト
  - [ ] エンドポイントテスト
  - [ ] エラーケーステスト
  - [ ] パフォーマンステスト

## フェーズ6: デプロイ準備
- [ ] 6.1 Cloud Run設定
  - [ ] Dockerfileの作成
  - [ ] Cloud Buildの設定
  - [ ] 環境変数の設定

- [ ] 6.2 監視・ロギング
  - [ ] Cloud Loggingの設定
  - [ ] エラー通知の設定
  - [ ] パフォーマンスモニタリング

## フェーズ7: AppSheet連携
- [ ] 7.1 AppSheet設定
  - [ ] Webhookの設定
  - [ ] レスポンス処理の実装
  - [ ] エラーハンドリング

## フェーズ8: テスト・検証
- [ ] 8.1 総合テスト
  - [ ] エンドツーエンドテスト
  - [ ] 負荷テスト
  - [ ] セキュリティテスト

- [ ] 8.2 ドキュメント整備
  - [ ] API仕様書の作成
  - [ ] デプロイメントガイド
  - [ ] トラブルシューティングガイド

## 完了基準
1. すべてのテストが成功すること
2. セキュリティチェックをパスすること
3. パフォーマンス要件を満たすこと
4. ドキュメントが完備されていること

## 注意事項
- コミットメッセージは日本語で具体的に記述
- 各フェーズでのレビューを必須とする
- セキュリティを常に最優先で考慮
- エラーハンドリングは丁寧に実装
