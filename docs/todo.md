# 開発計画と進捗管理

## フェーズ1: プロジェクトセットアップ
- [ ] 1.1 開発環境構築
  - [ ] Node.js v18以上のインストール確認
  - [ ] プロジェクトディレクトリの作成
  - [ ] .gitignoreの設定
  - [ ] ESLintとPrettierの設定

- [ ] 1.2 依存パッケージのセットアップ
  ```bash
  npm init -y
  npm install express puppeteer @google-cloud/local-auth googleapis
  npm install --save-dev nodemon eslint prettier
  ```

- [ ] 1.3 プロジェクト構成の作成
  ```
  dynamic-html-to-pdf/
  ├── src/
  │   ├── server.js      # メインサーバーファイル
  │   ├── services/      # ビジネスロジック
  │   │   ├── calendar.js
  │   │   ├── pdf.js
  │   │   └── drive.js
  │   └── utils/         # ユーティリティ関数
  │       └── error.js
  ├── templates/         # HTMLテンプレート
  │   └── template.html
  ├── tests/            # テストファイル
  └── docs/             # ドキュメント
  ```

## フェーズ2: 基本機能実装
- [ ] 2.1 カレンダー生成機能
  - [ ] generateCalendarHTML関数の実装
  - [ ] オーバーレイ処理の実装（○、△、◇、×）
  - [ ] カレンダーのテストケース作成

- [ ] 2.2 PDF生成機能
  - [ ] puppeteerセットアップ
  - [ ] HTML→PDF変換処理の実装
  - [ ] PDFオプション設定（A4、マージン等）
  - [ ] エラーハンドリング実装

- [ ] 2.3 Google Drive連携
  - [ ] Workload Identity設定
  - [ ] Drive API統合
  - [ ] アップロード機能実装
  - [ ] URL生成処理

## フェーズ3: APIエンドポイント実装
- [ ] 3.1 Express.jsサーバー構築
  - [ ] サーバー基本設定
  - [ ] ルーティング設定
  - [ ] ミドルウェア実装（エラーハンドリング、ログ）

- [ ] 3.2 /generate-pdf エンドポイント
  - [ ] リクエストバリデーション
  - [ ] レスポンス形式の統一
  - [ ] エラーレスポンス設計

## フェーズ4: セキュリティ実装
- [ ] 4.1 認証・認可
  - [ ] Workload Identity設定
  - [ ] IAMポリシー設定
  - [ ] AppSheet連携設定

- [ ] 4.2 入力検証
  - [ ] パラメーターバリデーション
  - [ ] サニタイズ処理
  - [ ] レートリミット実装

## フェーズ5: テスト実装
- [ ] 5.1 単体テスト
  - [ ] カレンダー生成テスト
  - [ ] PDF生成テスト
  - [ ] Drive APIテスト

- [ ] 5.2 結合テスト
  - [ ] エンドポイントテスト
  - [ ] エラーケーステスト
  - [ ] パフォーマンステスト

## フェーズ6: デプロイ準備
- [ ] 6.1 Cloud Run設定
  - [ ] Dockerfileの作成
  - [ ] Cloud Buildの設定
  - [ ] 環境変数の設定

- [ ] 6.2 監視・ロギング
  - [ ] Cloud Loggingの設定
  - [ ] エラー通知の設定
  - [ ] パフォーマンスモニタリング

## フェーズ7: AppSheet連携
- [ ] 7.1 AppSheet設定
  - [ ] Webhookの設定
  - [ ] レスポンス処理の実装
  - [ ] エラーハンドリング

## フェーズ8: テスト・検証
- [ ] 8.1 総合テスト
  - [ ] エンドツーエンドテスト
  - [ ] 負荷テスト
  - [ ] セキュリティテスト

- [ ] 8.2 ドキュメント整備
  - [ ] API仕様書の作成
  - [ ] デプロイメントガイド
  - [ ] トラブルシューティングガイド

## 完了基準
1. すべてのテストが成功すること
2. セキュリティチェックをパスすること
3. パフォーマンス要件を満たすこと
4. ドキュメントが完備されていること

## 注意事項
- コミットメッセージは日本語で具体的に記述
- 各フェーズでのレビューを必須とする
- セキュリティを常に最優先で考慮
- エラーハンドリングは丁寧に実装
